name: Azure Docs with Cost Optimization

on:
  pull_request:
    types: [opened, synchronize]
  push:
    branches: [main, develop]

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref || github.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name: Set deployment based on environment
        id: config
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            echo "deployment=gpt-4-prod" >> $GITHUB_OUTPUT
          else
            echo "deployment=gpt-35-turbo-dev" >> $GITHUB_OUTPUT
          fi
      
      - name: Generate Documentation
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          azure-openai-key: ${{ secrets.AZURE_OPENAI_KEY }}
          azure-openai-endpoint: ${{ secrets.AZURE_OPENAI_ENDPOINT }}
          azure-openai-deployment: ${{ steps.config.outputs.deployment }}
          mode: both
          docs-folder: docs/azure
          include-architecture-diagram: true
          include-security-notes: true
          include-cost-impact: true
          create-pr-comment: true

# This workflow demonstrates:
# - Using GPT-4 for production (main branch)
# - Using GPT-3.5-Turbo for development (other branches) - 95% cheaper!
# - All advanced features enabled
