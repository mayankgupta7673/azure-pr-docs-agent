name: Azure Docs (Azure OpenAI)

on:
  pull_request:
    types: [opened, synchronize]
  push:
    branches: [main, develop]

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref || github.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name: Generate Documentation with Azure OpenAI
        uses: mayankgupta7673/azure-integration-doc-agent@v1
        with:
          # GitHub configuration
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
          # Azure OpenAI configuration
          # Get these from: Azure Portal → Your OpenAI Resource → Keys and Endpoint
          openai-api-key: ${{ secrets.AZURE_OPENAI_KEY }}
          openai-api-endpoint: ${{ secrets.AZURE_OPENAI_ENDPOINT }}
          
          # This should be your DEPLOYMENT NAME, not the model name
          # Find it in: Azure OpenAI Studio → Deployments
          openai-model: gpt-4o
          
          # Documentation settings
          mode: both
          docs-folder: docs/azure
          
          # Optional: Enable all features
          include-architecture-diagram: true
          include-security-notes: true
          include-cost-impact: true
          create-pr-comment: true

# Example Azure OpenAI Endpoint format:
# https://<resource-name>.openai.azure.com/openai/deployments/<deployment-name>/chat/completions?api-version=2024-02-15-preview
#
# Full example:
# https://my-company-openai.openai.azure.com/openai/deployments/gpt-4-docs/chat/completions?api-version=2024-02-15-preview
