name: 'Azure Integration Doc Agent'
description: 'Automatically generates documentation for Azure integration changes using Azure OpenAI'
author: 'Mayank Gupta'
branding:
  icon: 'file-text'
  color: 'blue'

inputs:
  github-token:
    description: 'GitHub token for API access (use secrets.GITHUB_TOKEN)'
    required: true
  azure-openai-key:
    description: 'Azure OpenAI API key from Azure Portal'
    required: true
  azure-openai-endpoint:
    description: 'Azure OpenAI endpoint URL (format: https://<resource>.openai.azure.com/openai/deployments/<deployment>/chat/completions?api-version=2024-02-15-preview)'
    required: true
  azure-openai-deployment:
    description: 'Azure OpenAI deployment name (e.g., gpt-4, gpt-35-turbo)'
    required: true
  docs-folder:
    description: 'Folder where documentation should be stored'
    required: false
    default: 'docs'
  commit-message:
    description: 'Commit message for documentation updates'
    required: false
    default: 'docs: auto-generated Azure integration documentation [skip ci]'
  file-patterns:
    description: 'Comma-separated list of file patterns to watch (supports wildcards)'
    required: false
    default: '**/*.logicapp.json,**/apim-policy.xml,**/apim-*.xml,**/servicebus-*.json,**/eventhub-*.json,**/function.json,**/bicep/*.bicep,**/terraform/*.tf,**/*azure*.yaml,**/*azure*.yml'
  mode:
    description: 'Documentation mode: pr (per-PR docs), centralized (single file), both'
    required: false
    default: 'pr'
  central-doc-file:
    description: 'Filename for centralized documentation (used in centralized/both modes)'
    required: false
    default: 'azure-integrations.md'
  include-architecture-diagram:
    description: 'Generate mermaid architecture diagram suggestions (true/false)'
    required: false
    default: 'true'
  include-security-notes:
    description: 'Include security considerations in documentation (true/false)'
    required: false
    default: 'true'
  include-cost-impact:
    description: 'Include cost impact analysis in documentation (true/false)'
    required: false
    default: 'true'
  create-pr-comment:
    description: 'Create a comment on PR with documentation summary (true/false)'
    required: false
    default: 'true'
  fail-on-error:
    description: 'Fail the workflow if documentation generation fails (true/false)'
    required: false
    default: 'false'
  max-commits-to-analyze:
    description: 'Maximum number of commits to analyze in commit mode (for push events)'
    required: false
    default: '5'
  skip-if-no-changes:
    description: 'Skip action if no Azure files changed (true/false)'
    required: false
    default: 'true'
  auto-update-pr:
    description: 'Automatically update PR documentation when new commits are pushed (true/false)'
    required: false
    default: 'true'
  update-pr-title:
    description: 'Add [docs updated] tag to PR title when documentation is regenerated (true/false)'
    required: false
    default: 'false'
  update-pr-description:
    description: 'Update PR description with documentation summary (true/false)'
    required: false
    default: 'false'

outputs:
  docs-updated:
    description: 'Whether documentation was updated (true/false)'
  files-processed:
    description: 'Number of Azure integration files processed'
  documentation-path:
    description: 'Path to the generated/updated documentation'
  pr-comment-created:
    description: 'Whether a PR comment was created (true/false)'
  changes-summary:
    description: 'Summary of changes detected'
  pr-updated:
    description: 'Whether the PR was automatically updated (true/false)'

runs:
  using: 'node20'
  main: 'dist/index.js'
